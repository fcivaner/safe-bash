#!/usr/bin/env bash

# utility to clean command line history of certain records.

me=$(basename "${BASH_SOURCE[0]}")

function usage {
    echo "$me: utility to clean command line history of certain records."
    echo ""
    echo "usage: $me REGEX_PATTERN"
    exit
}

if [ "$#" -ne 1 ]; then
    usage
fi

HISTFILE=~/.bash_history
PATTERN=$1

echo "found entries:"
grep "$PATTERN" "$HISTFILE"

read -p "do you want to remove these entries? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]
then
    echo "removing entries with pattern $PATTERN.."
    tmpfile=$(mktemp)
    grep -v "$PATTERN" "$HISTFILE" > "$tmpfile"
    mv "$tmpfile" "$HISTFILE"
else
    echo "cancelled."
fi
